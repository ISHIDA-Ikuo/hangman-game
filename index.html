<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hangman Canvas Edition</title>
    <style>
        :root { --primary: #4f46e5; --bg: #f3f4f6; --text: #1f2937; }
        body { font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; color: var(--text); }
        
        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ãƒ‘ãƒãƒ« */
        .profile-card { background: white; padding: 15px 25px; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 15px; margin-bottom: 20px; width: 100%; max-width: 400px; }
        #avatar-box { width: 50px; height: 50px; border-radius: 50%; background: #e5e7eb; overflow: hidden; }
        .info { flex-grow: 1; }
        #name-label { font-weight: bold; font-size: 1.1rem; display: block; }
        #score-label { color: var(--primary); font-size: 0.9rem; font-weight: bold; }

        /* ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ */
        .game-container { background: white; padding: 25px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; display: flex; flex-direction: column; align-items: center; }
        canvas { background: #fafafa; border-radius: 12px; border: 1px solid #e5e7eb; margin-bottom: 20px; width: 100%; height: auto; max-width: 300px; }
        
        #word-display { font-size: 2.5rem; letter-spacing: 12px; margin: 15px 0; font-family: 'Courier New', monospace; font-weight: bold; }
        #message { height: 24px; margin-bottom: 10px; font-weight: bold; color: #ef4444; }
        #history { font-size: 0.85rem; color: #6b7280; margin-bottom: 20px; }

        /* å…¥åŠ›ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ */
        .input-group { display: flex; gap: 10px; width: 100%; }
        input[type="text"] { flex-grow: 1; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1.2rem; text-align: center; outline: none; transition: border 0.2s; }
        input[type="text"]:focus { border-color: var(--primary); }
        button { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        button:hover { opacity: 0.9; }

        .hidden { display: none; }

        /* é–‹å§‹ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .modal-inner { background: white; padding: 40px; border-radius: 24px; text-align: center; width: 85%; max-width: 350px; }
    </style>
</head>
<body>

    <div id="modal">
        <div class="modal-inner">
            <h2 style="margin-top:0">ğŸ® æœ€çµ‚ç‰ˆãƒãƒ³ã‚°ãƒãƒ³</h2>
            <p>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’æ±ºã‚ã¦ãã ã•ã„</p>
            <input type="text" id="user-name" placeholder="ä¾‹: å¤ªéƒ" style="width:100%; box-sizing:border-box; margin-bottom:20px;">
            <button onclick="bootGame()" style="width:100%">ãƒ—ãƒ¬ã‚¤é–‹å§‹</button>
        </div>
    </div>

    <div class="profile-card">
        <img id="avatar-box" src="" alt="Avatar">
        <div class="info">
            <span id="name-label">Player</span>
            <span id="score-label">ã‚¹ã‚³ã‚¢: 0</span>
        </div>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="200" height="250"></canvas>
        
        <div id="word-display">_ _ _ _</div>
        <div id="message"></div>
        <div id="history">ä½¿ã£ãŸæ–‡å­—: ãªã—</div>

        <div id="input-ui" class="input-group">
            <input type="text" id="guess-input" maxlength="1" placeholder="A" inputmode="text">
            <button onclick="processGuess()">é€ä¿¡</button>
        </div>
        <button id="next-btn" class="hidden" onclick="initRound()" style="width:100%">æ¬¡ã®å•é¡Œã¸</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const words = ["GALAXY", "PIZZA", "PYTHON", "GITHUB", "SYSTEM", "JAPAN", "COFFEE", "ORANGE", "BOTTLE", "DREAM"];
        
        let targetWord = "";
        let foundLetters = [];
        let usedLetters = [];
        let mistakes = 0;
        let score = 0;

        // ã‚²ãƒ¼ãƒ èµ·å‹•
        function bootGame() {
            const name = document.getElementById('user-name').value || "åç„¡ã—ã•ã‚“";
            document.getElementById('name-label').innerText = name;
            document.getElementById('avatar-box').src = `https://api.dicebear.com/7.x/bottts/svg?seed=${name}`;
            document.getElementById('modal').style.display = 'none';
            initRound();
        }

        // ãƒ©ã‚¦ãƒ³ãƒ‰åˆæœŸåŒ–
        function initRound() {
            targetWord = words[Math.floor(Math.random() * words.length)];
            foundLetters = [];
            usedLetters = [];
            mistakes = 0;
            
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('input-ui').classList.remove('hidden');
            document.getElementById('message').innerText = "";
            render();
            drawCanvas(0);
        }

        // æç”»æ›´æ–°
        function render() {
            let display = "";
            for (let char of targetWord) {
                display += foundLetters.includes(char) ? char : "_";
            }
            document.getElementById('word-display').innerText = display;
            document.getElementById('history').innerText = "ä½¿ã£ãŸæ–‡å­—: " + usedLetters.join(", ");

            if (!display.includes("_")) {
                handleWin();
            } else if (mistakes >= 6) {
                handleLoss();
            }
        }

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®æç”»ãƒ­ã‚¸ãƒƒã‚¯
        function drawCanvas(step) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = "#374151";
            ctx.lineWidth = 4;
            ctx.lineCap = "round";

            // 1. åœŸå°ã¨æŸ± (å¸¸ã«è¡¨ç¤º)
            ctx.beginPath();
            ctx.moveTo(20, 230); ctx.lineTo(180, 230); // ãƒ™ãƒ¼ã‚¹
            ctx.moveTo(50, 230); ctx.lineTo(50, 20);   // æŸ±
            ctx.lineTo(130, 20); ctx.lineTo(130, 50);  // æ¨ªæ¢
            ctx.stroke();

            if (step >= 1) { // é ­
                ctx.beginPath(); ctx.arc(130, 70, 20, 0, Math.PI * 2); ctx.stroke();
            }
            if (step >= 2) { // èƒ´ä½“
                ctx.beginPath(); ctx.moveTo(130, 90); ctx.lineTo(130, 160); ctx.stroke();
            }
            if (step >= 3) { // å·¦è…•
                ctx.beginPath(); ctx.moveTo(130, 110); ctx.lineTo(100, 140); ctx.stroke();
            }
            if (step >= 4) { // å³è…•
                ctx.beginPath(); ctx.moveTo(130, 110); ctx.lineTo(160, 140); ctx.stroke();
            }
            if (step >= 5) { // å·¦è¶³
                ctx.beginPath(); ctx.moveTo(130, 160); ctx.lineTo(100, 200); ctx.stroke();
            }
            if (step >= 6) { // å³è¶³
                ctx.beginPath(); ctx.moveTo(130, 160); ctx.lineTo(160, 200); ctx.stroke();
            }
        }

        // æ–‡å­—å…¥åŠ›æ™‚ã®å‡¦ç†
        function processGuess() {
            const input = document.getElementById('guess-input');
            const char = input.value.toUpperCase();
            input.value = "";
            input.focus();

            if (!char.match(/[A-Z]/) || char === "" || usedLetters.includes(char)) return;

            usedLetters.push(char);
            if (targetWord.includes(char)) {
                foundLetters.push(char);
            } else {
                mistakes++;
                drawCanvas(mistakes);
            }
            render();
        }

        function handleWin() {
            document.getElementById('message').innerText = "ğŸ‰ æ­£è§£ï¼ãŠã‚ã§ã¨ã†ï¼";
            document.getElementById('message').style.color = "#10b981";
            score += 10;
            document.getElementById('score-label').innerText = "ã‚¹ã‚³ã‚¢: " + score;
            finishGame();
        }

        function handleLoss() {
            document.getElementById('message').innerText = "ğŸ’€ çµ‚äº†... æ­£è§£ã¯ " + targetWord;
            document.getElementById('message').style.color = "#ef4444";
            finishGame();
        }

        function finishGame() {
            document.getElementById('input-ui').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
        }

        // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§é€ä¿¡
        document.getElementById('guess-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') processGuess();
        });
    </script>
</body>
</html>
