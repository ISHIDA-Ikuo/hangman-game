<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Panda Park v1.8 - Animated Panda</title>
    <style>
        :root { --primary: #002654; --bg: #f3f4f6; --win: #10b981; --lose: #ed2939; }
        body { 
            font-family: sans-serif; background: var(--bg); 
            margin: 0; padding: 5px; 
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden; 
        }
        .version-badge { font-size: 0.7rem; color: #9ca3af; margin-top: 5px; }
        .game-container { 
            background: white; padding: 10px; border-radius: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            width: 92%; max-width: 340px;
            display: flex; flex-direction: column; align-items: center;
            gap: 5px;
        }

        /* ãƒ‘ãƒ³ãƒ€ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š */
        #panda-container { 
            height: 90px; width: 100%; 
            display: flex; justify-content: center; align-items: flex-end; /* ä¸‹ã‹ã‚‰å‡ºã™ãŸã‚ã«ä¸‹æƒãˆ */
            background: #fff; border: 1px solid #eee; border-radius: 12px;
            overflow: hidden; position: relative;
        }
        #panda-img { 
            max-height: 80px; display: none; 
            position: relative;
            transition: transform 0.5s ease-out;
        }

        /* æˆåŠŸæ™‚ã®è·³ã­ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .bounce { animation: bounce 0.6s infinite; }

        /* å¤±æ•—æ™‚ã®éœ‡ãˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes shake-panda {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
        }
        .shake-panda { animation: shake-panda 0.3s infinite; }

        canvas { background: #fafafa; border-radius: 10px; width: 140px; height: 100px; }
        .used-letters-container { font-size: 0.8rem; color: #666; width: 100%; text-align: center; min-height: 20px; }
        .letter-history { font-weight: bold; letter-spacing: 3px; }
        .wrong-letter { color: var(--lose); text-decoration: line-through; }
        .correct-letter { color: #2563eb; }

        #word-display { font-size: 1.6rem; letter-spacing: 5px; font-weight: bold; margin: 2px 0; }
        #message { font-size: 0.9rem; font-weight: bold; height: 18px; color: var(--primary); }

        .controls { width: 100%; min-height: 50px; display: flex; align-items: center; justify-content: center; }
        .input-group { display: flex; gap: 8px; width: 100%; }
        input[type="text"] { flex-grow: 1; padding: 10px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.2rem; text-align: center; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; font-size: 1rem; }
        #next-btn { width: 100%; display: none; }
        
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .modal-inner { background: white; padding: 20px; border-radius: 20px; text-align: center; }
    </style>
</head>
<body>

    <div id="modal">
        <div class="modal-inner">
            <h2>ğŸ¼ Panda Park v1.8</h2>
            <p>Le Panda va s'animer !</p>
            <button onclick="bootGame()">COMMENCER</button>
        </div>
    </div>

    <div class="version-badge">Version 1.8 (Animated Panda)</div>
    
    <div class="game-container">
        <div id="panda-container">
            <img id="panda-img" src="" alt="Panda">
            <span id="wait-msg" style="color:#eee">PANDA</span>
        </div>

        <canvas id="gameCanvas" width="200" height="150"></canvas>
        
        <div class="used-letters-container">
            Lettres: <span id="used-history" class="letter-history"></span>
        </div>

        <div id="word-display">_ _ _ _</div>
        <div id="message"></div>
        
        <div class="controls">
            <div id="input-ui" class="input-group">
                <input type="text" id="guess-input" maxlength="1" placeholder="A-Z" inputmode="text">
                <button onclick="processGuess()">OK</button>
            </div>
            <button id="next-btn" onclick="initRound()">SUIVANT (NEXT) â”</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const inputField = document.getElementById('guess-input');
        const inputUI = document.getElementById('input-ui');
        const nextBtn = document.getElementById('next-btn');
        const usedHistory = document.getElementById('used-history');
        const pandaImg = document.getElementById('panda-img');
        const waitMsg = document.getElementById('wait-msg');
        
        const words = ["PANDA", "BAMBOU", "FRANCE", "PARIS", "SOLEIL", "BATEAU", "ECOLE", "JARDIN", "FROMAGE", "TOUR", "MUSIQUE", "VOYAGE", "AMOUR", "CAFE", "BAGUETTE", "MER"];
        let targetWord, foundLetters, usedLetters, mistakes;

        function bootGame() {
            document.getElementById('modal').style.display = 'none';
            initRound();
        }

        function initRound() {
            targetWord = words[Math.floor(Math.random() * words.length)];
            foundLetters = []; usedLetters = []; mistakes = 0;
            
            pandaImg.style.display = "none";
            pandaImg.classList.remove('bounce', 'shake-panda');
            pandaImg.style.transform = "translateY(50px)"; // æœ€åˆã¯ä¸‹ã«éš ã™
            waitMsg.style.display = "block";
            
            inputUI.style.display = "flex";
            nextBtn.style.display = "none";
            usedHistory.innerHTML = "";
            document.getElementById('message').innerText = "Devinez !";
            render(); drawCanvas(0);
            setTimeout(() => inputField.focus(), 100);
        }

        function render() {
            let display = "";
            for (let char of targetWord) display += foundLetters.includes(char) ? char : "_";
            document.getElementById('word-display').innerText = display;
            updateHistory();

            if (!display.includes("_")) {
                document.getElementById('message').innerText = "ğŸ† GAGNÃ‰ !";
                showPanda(true);
                showNextButton(true);
            } else if (mistakes >= 6) {
                document.getElementById('message').innerText = "ğŸ’€ PERDU : " + targetWord;
                showPanda(false);
                showNextButton(false);
            }
        }

        function updateHistory() {
            usedHistory.innerHTML = "";
            usedLetters.forEach(char => {
                const span = document.createElement('span');
                span.innerText = char + " ";
                span.className = targetWord.includes(char) ? "correct-letter" : "wrong-letter";
                usedHistory.appendChild(span);
            });
        }

        function showNextButton(isWin) {
            inputUI.style.display = "none";
            nextBtn.style.display = "block";
            nextBtn.style.backgroundColor = isWin ? "var(--win)" : "var(--lose)";
        }

        function showPanda(isSuccess) {
            waitMsg.style.display = "none";
            pandaImg.style.display = "block";
            
            // ä¸‹ã‹ã‚‰ã²ã‚‡ã£ã“ã‚Šç¾ã‚Œã‚‹å‹•ã
            setTimeout(() => {
                pandaImg.style.transform = "translateY(0)";
                if (isSuccess) {
                    pandaImg.src = "https://45jp.net/panda/wp-content/uploads/2021/08/warau-panda.gif?t=" + new Date().getTime();
                    pandaImg.classList.add('bounce'); // è·³ã­ã‚‹
                } else {
                    pandaImg.src = "https://45jp.net/panda/wp-content/uploads/2021/08/warau-panda.png";
                    pandaImg.style.filter = "grayscale(100%)";
                    pandaImg.classList.add('shake-panda'); // éœ‡ãˆã‚‹
                }
            }, 50);
        }

        function drawCanvas(step) {
            ctx.clearRect(0,0,200,150); ctx.strokeStyle="#333"; ctx.lineWidth=4;
            ctx.beginPath(); ctx.moveTo(20,140); ctx.lineTo(180,140); ctx.moveTo(50,140); ctx.lineTo(50,10); ctx.lineTo(130,10); ctx.lineTo(130,30); ctx.stroke();
            if(step>=1){ ctx.beginPath(); ctx.arc(130,45,15,0,Math.PI*2); ctx.stroke(); }
            if(step>=2){ ctx.beginPath(); ctx.moveTo(130,60); ctx.lineTo(130,100); ctx.stroke(); }
            if(step>=3){ ctx.beginPath(); ctx.moveTo(130,70); ctx.lineTo(110,90); ctx.stroke(); }
            if(step>=4){ ctx.beginPath(); ctx.moveTo(130,70); ctx.lineTo(150,90); ctx.stroke(); }
            if(step>=5){ ctx.beginPath(); ctx.moveTo(130,100); ctx.lineTo(110,130); ctx.stroke(); }
            if(step>=6){ ctx.beginPath(); ctx.moveTo(130,100); ctx.lineTo(150,130); ctx.stroke(); }
        }

        function processGuess() {
            const char = inputField.value.trim().toUpperCase(); 
            inputField.value = "";
            if (!char.match(/[A-Z]/) || char === "" || usedLetters.includes(char)) return;
            usedLetters.push(char);
            if (targetWord.includes(char)) foundLetters.push(char); else { mistakes++; drawCanvas(mistakes); }
            render();
            setTimeout(() => inputField.focus(), 10);
        }

        inputField.addEventListener('keydown', (e) => { if (e.key === 'Enter') processGuess(); });
    </script>
</body>
</html>
